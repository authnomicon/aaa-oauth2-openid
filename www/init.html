<head>
  <title>Check Session Iframe</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
</head>
<body>
	<script type="text/javascript">
    
  function getMsg(domain, ts) {
    console.log('TIMESTAMP: ' + ts);
    
    var b = ts;
    
    if (ts) {
      if (ts >= 0) {
        console.log('GT0');
        ts = (new Date).getTime() - ts, ts = !ts || 0 > ts ? 0 : ts
        console.log(ts);
        
      } else {
        ts = 0;
      }
    }
    
    console.log('NOW TS');
    console.log(ts);
    
    console.log('--')
    console.log(!b)
    console.log(0 >= b);
    console.log((new Date).getTime() - b)
    console.log(b = !b)
    console.log('--')
    
    
    
    !b || 0 >= b ? b = 0 : (b = (new Date).getTime() - b, b = !b || 0 > b ? 0 : b);
    
    console.log('b: ' + b);
    
    
    var n = 'CheckConnectionTempCookie' + String(Math.floor(1000 * Math.random()));
    var val = String(Math.floor(1000000 * Math.random()));

    console.log(n);
    console.log(val);
    var exp = new Date((new Date).getTime() + 10000); // 10 seconds from now
    console.log(exp);
    
    document.cookie = n + '=' + val + '; Expires=' + exp.toUTCString();
    
    var x, c;
    x: {
      console.log('HERE?');
      
      if (document.cookie) {
        // This is a check if cookies are allowed, i bieleve?
      }
      
      /*
      if (document.cookie)
          for (var c = c + "=", f = document.cookie.split(Ga), e = 0; e < f.length; e++) {
              var g = f[e],
                  g = g.replace(/^\s+/, ""),
                  g = g.replace(/\s+$/, "");
              if (0 == g.indexOf(c)) {
                  c = g.substr(c.length);
                  break ts
              }
          }
      c = void 0
      */
    }
    
    console.log('X');
    console.log(x)
    
    
    return domain + ':' + String(ts) + ':' + '1';
  }
    
    
    jQuery(function() {
      console.log('init session iframe ready...')
      
      
      
      var origin = 'http://localhost:3001';
      //var timestamp = 1490391034081;
      //                1490400223086
      var timestamp = Date.now() - 250;
      
      var msg = getMsg('youtube', timestamp);
      //var msg = getMsg('youtube');
      
      window.parent.postMessage(msg, origin);
    });
    
	</script>
</body>